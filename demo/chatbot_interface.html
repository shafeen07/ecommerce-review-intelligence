<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Commerce Analytics Chatbot</title>
    <!-- NOTE: Lambda Function URL has been removed for security. 
         This is the UI interface used in the demo video. -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #232F3E 0%, #131A22 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 1000px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 90vh;
        }
        
        .header {
            background: linear-gradient(135deg, #FF9900 0%, #FF6F00 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.95;
        }
        
        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            background: #f8f9fa;
        }
        
        .message {
            margin-bottom: 24px;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message.user {
            display: flex;
            justify-content: flex-end;
        }
        
        .message.assistant {
            display: flex;
            justify-content: flex-start;
        }
        
        .message-bubble {
            max-width: 75%;
            padding: 16px 20px;
            border-radius: 18px;
            line-height: 1.6;
            font-size: 15px;
        }
        
        .message.user .message-bubble {
            background: linear-gradient(135deg, #FF9900 0%, #FF6F00 100%);
            color: white;
        }
        
        .message.assistant .message-bubble {
            background: white;
            color: #333;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .sql-query {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 12px 16px;
            border-radius: 8px;
            margin: 12px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        
        .sql-label {
            color: #FF9900;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
            text-transform: uppercase;
        }
        
        .loading {
            display: flex;
            gap: 8px;
            padding: 16px 20px;
        }
        
        .loading span {
            width: 10px;
            height: 10px;
            background: #667eea;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        
        .loading span:nth-child(1) { animation-delay: -0.32s; }
        .loading span:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        
        .input-area {
            padding: 24px 30px;
            background: white;
            border-top: 1px solid #e0e0e0;
        }
        
        .examples {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }
        
        .example-chip {
            padding: 8px 14px;
            background: #FFF3E0;
            border: 1px solid #FF9900;
            border-radius: 20px;
            font-size: 13px;
            color: #FF6F00;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .example-chip:hover {
            background: #FF9900;
            color: white;
            transform: translateY(-2px);
        }
        
        .input-wrapper {
            display: flex;
            gap: 12px;
        }
        
        #userInput {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 15px;
            outline: none;
            transition: border-color 0.3s;
        }
        
        #userInput:focus {
            border-color: #FF9900;
        }
        
        #sendBtn {
            padding: 16px 32px;
            background: linear-gradient(135deg, #FF9900 0%, #FF6F00 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        #sendBtn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 153, 0, 0.4);
        }
        
        #sendBtn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .welcome {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 16px 20px;
            border-radius: 8px;
            color: #1565c0;
            margin-bottom: 20px;
        }
        
        .welcome strong {
            display: block;
            margin-bottom: 8px;
        }
        
        .error {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 16px 20px;
            border-radius: 8px;
            color: #c62828;
        }
        
        .row-count {
            font-size: 12px;
            color: #666;
            font-style: italic;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõçÔ∏è E-Commerce Analytics Chatbot</h1>
            <p>Ask questions about electronics product reviews on Amazon ‚Ä¢ Powered by Claude</p>
            <p style="font-size: 12px; opacity: 0.85; margin-top: 8px;">Demo Dataset: 47 products (2018-2023) ‚Ä¢ Scalable architecture</p>
        </div>
        
        <div class="chat-area" id="chatArea">
            <div class="welcome">
                <strong>üëã Welcome to your E-Commerce Intelligence Platform!</strong>
                I can help you analyze electronics product performance, sentiment trends, and customer feedback from Amazon reviews. The analytics are derived from millions of reviews, aggregated into actionable insights. Try the example questions below or ask anything!
                <br><br>
                <em style="font-size: 13px; opacity: 0.8;">Note: This demo uses a curated sample of 47 products to showcase the system's capabilities. The architecture scales to millions of products.</em>
            </div>
        </div>
        
        <div class="input-area">
            <div class="examples">
                <div class="example-chip" onclick="askExample('What are the top 5 products by satisfaction rate?')">
                    üèÜ Top Products
                </div>
                <div class="example-chip" onclick="askExample('What do customers say about the top-rated products?')">
                    üí¨ Customer Feedback
                </div>
                <div class="example-chip" onclick="askExample('Which products have surging momentum?')">
                    üöÄ Surging Products
                </div>
                <div class="example-chip" onclick="askExample('Compare stores by average rating')">
                    üè™ Store Comparison
                </div>
            </div>
            
            <div class="input-wrapper">
                <input 
                    type="text" 
                    id="userInput" 
                    placeholder="Ask about products, trends, sentiment..." 
                    onkeypress="handleKeyPress(event)"
                >
                <button id="sendBtn" onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>
    
    <script>
        // Lambda Function URL - DEMO VERSION (Pandas with review text)
        const LAMBDA_URL = 'PUT LAMBDA FUNCTION HERE';
        
        const chatArea = document.getElementById('chatArea');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        
        // Store conversation history for context retention
        let conversationHistory = [];
        
        function addMessage(content, type, sqlQuery = null, rowCount = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            
            if (type === 'loading') {
                bubble.className = 'loading';
                bubble.innerHTML = '<span></span><span></span><span></span>';
            } else {
                if (sqlQuery && type === 'assistant') {
                    const sqlLabel = document.createElement('div');
                    sqlLabel.className = 'sql-label';
                    sqlLabel.textContent = 'üîç SQL Query Generated:';
                    bubble.appendChild(sqlLabel);
                    
                    const sqlDiv = document.createElement('div');
                    sqlDiv.className = 'sql-query';
                    sqlDiv.textContent = sqlQuery;
                    bubble.appendChild(sqlDiv);
                    
                    const br = document.createElement('br');
                    bubble.appendChild(br);
                }
                
                const textDiv = document.createElement('div');
                textDiv.innerHTML = content.replace(/\n/g, '<br>');
                bubble.appendChild(textDiv);
                
                if (rowCount !== null && type === 'assistant') {
                    const countDiv = document.createElement('div');
                    countDiv.className = 'row-count';
                    countDiv.textContent = `üìä ${rowCount} row${rowCount !== 1 ? 's' : ''} returned`;
                    bubble.appendChild(countDiv);
                }
            }
            
            messageDiv.appendChild(bubble);
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
            
            return messageDiv;
        }
        
        function askExample(question) {
            userInput.value = question;
            sendMessage();
        }
        
        async function sendMessage() {
            const query = userInput.value.trim();
            if (!query) return;
            
            // Add user message
            addMessage(query, 'user');
            userInput.value = '';
            
            // Disable input
            sendBtn.disabled = true;
            userInput.disabled = true;
            
            // Show loading
            const loadingMsg = addMessage('', 'loading');
            
            try {
                const response = await fetch(LAMBDA_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        query: query,
                        conversation_history: conversationHistory 
                    })
                });
                
                const data = await response.json();
                
                // Remove loading
                loadingMsg.remove();
                
                if (data.success) {
                    addMessage(
                        data.response, 
                        'assistant', 
                        data.sql_executed || null,
                        data.row_count || null
                    );
                    
                    // Update conversation history (keep last 4 exchanges = 8 messages)
                    conversationHistory.push({
                        role: 'user',
                        content: [{ text: query }]
                    });
                    conversationHistory.push({
                        role: 'assistant',
                        content: [{ text: data.response }]
                    });
                    
                    // Keep only last 8 messages (4 Q&A pairs)
                    if (conversationHistory.length > 8) {
                        conversationHistory = conversationHistory.slice(-8);
                    }
                } else {
                    const errorMsg = document.createElement('div');
                    errorMsg.className = 'error';
                    errorMsg.innerHTML = `<strong>‚ùå Error:</strong> ${data.error || 'Unknown error occurred'}`;
                    chatArea.appendChild(errorMsg);
                    chatArea.scrollTop = chatArea.scrollHeight;
                }
            } catch (error) {
                loadingMsg.remove();
                const errorMsg = document.createElement('div');
                errorMsg.className = 'error';
                errorMsg.innerHTML = `<strong>‚ùå Network Error:</strong> ${error.message}<br><small>Make sure your Lambda Function URL is correct and CORS is enabled.</small>`;
                chatArea.appendChild(errorMsg);
                chatArea.scrollTop = chatArea.scrollHeight;
            }
            
            // Re-enable input
            sendBtn.disabled = false;
            userInput.disabled = false;
            userInput.focus();
        }
        
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
        
        // Focus input on load
        window.onload = () => {
            userInput.focus();
        };
    </script>
</body>
</html>